import streamlit as st
import fitz  # PyMuPDF
import openai

st.sidebar.success("Create a short quiz based on a PDF file")

# Define the OpenAI API key
openai.api_key = 'KEY'

# Define the function to summarize text
def abstract_summary_extraction(text):
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {
                "role": "system",
                "content": "You are a highly skilled AI trained in language comprehension and summarization. I would like you to read the following text and summarize it into a concise abstract paragraph. Aim to retain the most important points, providing a coherent and readable summary that could help a person understand the main points of the discussion without needing to read the entire text."
            },
            {
                "role": "user",
                "content": text
            }
        ]
    )
    return response['choices'][0]['message']['content']

# Define the function to generate quiz questions
def generate_quiz_questions(summary):
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {
                "role": "system",
                "content": "You are a helpful assistant.You are able to generate three quiz questions based on the following text. Please generate three multiple-choice questions with four possible answers, one of which is correct. The question should be based on the most important point in the text. The correct answer to the questions should be bolded on the next line at the bottom of the question. The other three answers should be plausible distractors that could be true but are not directly supported by the text. The question should be clear and concise, and the answers should be plausible enough to make the question challenging. The format of the output should be all the answer choices or optionss are on seperate lines and the correct answer is bolded at the end of the question."
            },
            {
                "role": "user",
                "content": summary
            }
        ]
    )
    return response['choices'][0]['message']['content']

# Create a Streamlit app
st.title('Quiz Question Generator')

# Allow the user to upload a PDF
uploaded_file = st.file_uploader("Choose a PDF file", type="pdf")

# If a file is uploaded, read and translate it
if uploaded_file is not None:
    # Load the PDF file
    pdf = fitz.open(stream=uploaded_file.read(), filetype="pdf")

    # Read the text from the PDF file
    text = ""
    for page in pdf:
        text += page.get_text()

    # Summarize the text
    summary = abstract_summary_extraction(text)

    # Generate quiz questions
    quiz_questions = generate_quiz_questions(summary)

    # Display the quiz questions
    st.write(f'Quiz Questions: {quiz_questions}')
    st.write(f'Quiz Questions: {quiz_questions}')
